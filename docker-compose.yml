services:
  web:
    build:
      context: .
      dockerfile: ./web/Dockerfile
    container_name: next-dev
    volumes:
      - ./web:/app:cached         # ソースをホストと同期（mac/Windows で :cached を推奨）
      - /app/node_modules         # node_modules をコンテナに確保
    ports:
      - "3000:3000"
    tty: true
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_FIREBASE_PROJECT_ID=polaris-link
      - NEXT_PUBLIC_FIREBASE_AUTH_EMULATOR_HOST=host.docker.internal:9099
      - NEXT_PUBLIC_FIRESTORE_EMULATOR_HOST=host.docker.internal:8080
    depends_on:
      - firebase

  firebase:
    image: andreysenov/firebase-tools:latest  # 例。お好みの firebase-tools イメージに変更可
    container_name: firebase-emulator
    working_dir: /workspace
    volumes:
      - ./firebase:/workspace
    ports:
      - "4000:4000"   # Emulator UI
      - "8080:8080"   # Firestore emulator
      - "9199:9199"   # Storage emulator (例)
      - "9099:9099"   # Auth emulator
      - "5001:5001"   # Functions emulator (例)
      - "4500:4500"   # Functions emulator (例)
      - "9150:9150"   # Functions emulator (例)
    # command: >
    #   sh -c "firebase emulators:start
    #          --import=/data
    #          --export-on-exit=/data"
    environment:
      - COLUMNS=80
      - FIREBASE_TOKEN=${FIREBASE_TOKEN}
    tty: true
