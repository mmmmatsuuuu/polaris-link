# 一括登録設計

## 目的
- 管理画面から対象データをJSONで一括登録する
- FirestoreとTipTap Docに適した形式で安全に登録する

## 対象範囲
- 画面ごとに単一の対象のみを一括登録する
    - 生徒
    - 科目
    - 単元
    - 授業
    - コンテンツ
- 異なる対象を同一ファイルで混在させない

## 入力形式
- JSONファイル
- 配列形式を基本とする

例: 生徒
```json
{
  "students": [
    { "name": "田中", "email": "a@example.com" },
    { "name": "鈴木", "email": "b@example.com" }
  ]
}
```

例: 単元
```json
{
  "units": [
    { "name": "一次関数", "subjectId": "existingSubjectId" }
  ]
}
```

例: コンテンツ(TipTap Doc)
```json
{
  "contents": [
    {
      "lessonId": "existingLessonId",
      "contentType": "text",
      "title": "補足",
      "data": { "tiptapDoc": { "type": "doc", "content": [] } }
    }
  ]
}
```

## バリデーション
- JSON構造、必須項目、型の検証を行う
- 総ドキュメント数は300件以下
- 親子参照は既存IDの存在を検証する
- 重複は入力内で検知する

## 書き込み方式
- サーバー側で書き込み単位に展開する
- 1バッチでFirestoreに書き込む
- 失敗時は全件ロールバックする
- IDはサーバー側で自動生成する

## エラー表示
- バリデーションエラーは項目名と配列インデックスを返す
- 書き込み失敗時はエラー理由を表示する

## 制約
- 1回の一括登録で最大300件まで
- 300件を超える場合はアップロード前にエラーとする

## 親子参照IDの取得手段
- 管理画面の詳細/一覧でIDを表示する
- 一覧にはコピーボタンを用意し、クリックでIDをクリップボードにコピーする
- JSON入力に必要な親IDは、管理画面で取得したIDを利用する
