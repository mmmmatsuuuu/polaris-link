# 要件定義書

## 1. 概要

本システムは、教師と生徒間の学習活動を支援するためのウェブアプリケーションである。教師は学習コンテンツ（動画、小テストなど）を管理し、生徒の学習状況を把握できる。生徒は提供されたコンテンツを利用して学習を進め、自身の進捗を確認できる。

## 2. ユーザーと役割

- **運用者/教師**: 本システムの開発者が唯一の教師アカウントとして想定され、学習コンテンツの作成・管理、生徒の登録、学習状況のモニタリングを行う。必要に応じて他者を利用させる場合は一旦生徒として登録し、Firebaseコンソールで権限を手動変更する。
- **生徒**: 登録された学習コンテンツを閲覧・利用し、学習を進める。年度単位で一括管理し、クラスやコースによる細分化は行わない。

## 3. 機能要件

### 3.1. 認証
- 教師、生徒ともにGoogleアカウントによるOAuth認証でログインする。
- 教師は生徒のGoogleメールアドレスを登録することで、生徒に利用権限を付与する。
- 登録されたメールアドレスを持つ生徒は、ログインボタンを押すだけでシステムを利用できる。
- アクセス制御は登録済みメールアドレスによるホワイトリスト方式とし、教師権限はFirebase側でのみ手動付与する。サポート担当・保護者などの追加ロールは設けない。
- 学習コンテンツは未ログインでも閲覧できるが、学習ログを記録したい場合はログインを必要とする。

### 3.2. 学習コンテンツ管理 (教師向け)
- **コンテンツの階層構造**:
    - 科目 > 単元 > 授業 の階層でコンテンツを管理する。
    - 授業は単元に、単元は科目に紐付けることができる。
    - 紐付けは専用の管理ページで行う。
    - 年度ごとに授業や単元の利用・非利用を選択できる。
- **コンテンツの種類**:
    - **動画**: YouTube動画をiframeで埋め込む形式。
    - **小テスト**: 以下の形式の問題を作成できる。
        - 選択問題
        - 並び替え問題
        - 記述問題（用語レベル）
    - **その他教材**: 外部リソースへのURLリンク。
- **公開状態**:
    - 授業および個別コンテンツに公開・非公開のフラグを持たせ、教師が任意に切り替えられる。
    - 非公開状態のコンテンツは生徒画面に表示しない。
- **一括登録**:
    - 生徒情報、科目、単元、授業、コンテンツ情報をCSVファイルで一括登録・更新できる。
    - CSVフォーマット、必須項目、バリデーションルールを定義し、アップロード時に検証・エラー表示を行う。

### 3.3. 学習コンテンツ利用 (生徒向け)
- **コンテンツの閲覧**:
    - 全ての単元、授業、コンテンツを閲覧できる。ログイン無しでもアクセス可能とし、卒業後の生徒も引き続き利用できる。
    - 教師によって単元に紐付けられていない授業も一覧で閲覧できるページを設ける。
- **学習の記録**:
    - 動画の視聴状況（再生・完了など）。YouTube APIから取得した再生時間が2分以上（または動画長の一定割合）に達したら視聴済みとして記録する。
    - 小テストの解答結果。各問題にユニークIDを付与し、回答ごとに正誤・回答内容・回答時刻を保存することで生徒のつまずき箇所を可視化する。同一小テストの再受験履歴も保持する。

### 3.4. 学習状況の確認
- **教師向け**:
    - 生徒全体の学習進捗を科目・単元・授業単位で集計・可視化する。
    - 個々の生徒の学習状況（動画視聴時間、小テストの正答率、問題別の正誤履歴など）を詳細に確認できる。
- **生徒向け**:
    - 自身の学習履歴や進捗状況（どのコンテンツを完了したかなど）を確認できるダッシュボード機能。

## 4. 非機能要件

- **UI/UX**:
    - 教師、生徒ともに直感的に操作できるシンプルなインターフェースを提供する。
- **将来的な拡張性**:
    - コミュニケーション機能（掲示板、コメント機能など）の追加を検討する可能性があるため、拡張しやすい設計とする。
- **セキュリティ/個人情報保護**:
    - 利用者が限定されるため多要素認証は導入しないが、登録メールアドレスのホワイトリスト管理とFirebaseの権限設定によりアクセスを制限する。
    - 生徒情報・学習履歴の取り扱いに関する個人情報保護方針を策定し、閲覧ログと操作ログをFirebaseで取得・保管する。
- **技術スタック**:
    - Next.js + Firebaseを前提とし、ホスティングはVercel上で行う。認証、データベース、ストレージなどはFirebaseで統一してシンプルな運用を可能にする。
