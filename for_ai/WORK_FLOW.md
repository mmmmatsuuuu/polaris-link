# 実装ワークフロー

このドキュメントは、`DESIGN.md`に基づいたPolaris-Linkアプリケーションの実装手順を定義します。

## Phase 0: 開発環境の構築 (Docker)

- [x] **Docker設定ファイルの作成**:
  - [x] `Dockerfile` を作成し、Next.jsの実行環境を定義します。
  - [x] `docker-compose.yml` を作成します。
- [ ] **コンテナの定義**:
  - [x] Next.js用のサービスを定義します（ホットリロード有効）。
  - [x] Firebase Local Emulator Suite（Auth, Firestore, Functions）用のサービスを定義します。
- [x] **環境の起動と連携**:
  - [x] `docker-compose up` でコンテナを起動し、Next.jsアプリがFirebaseエミュレータを参照するように設定します。

## Phase 1: プロジェクト初期設定

- [x] **Next.jsプロジェクトの作成**: `create-next-app` を使用して、TypeScript環境のプロジェクトを初期化します。
- [x] **Firebaseプロジェクトのセットアップ**:
  - [x] Firebaseコンソールで本番用の新規プロジェクトを作成します。
  - [x] Authentication (Googleログイン) を有効化します。
  - [x] Cloud Firestore データベースを作成します。
  - [x] WebアプリをFirebaseプロジェクトに追加し、設定情報(`firebaseConfig`)を取得します。
- [x] **フロントエンドのセットアップ**:
  - [x] Tailwind CSSを導入します。
  - [x] `shadcn/ui` をセットアップし、基本的なコンポーネントを導入します。
  - [x] Firebase SDKをインストールし、初期化処理を実装します（開発環境と本番環境で設定を切り替えられるようにします）。
- [x] **バージョン管理**:
  - [x] GitHubリポジトリを作成し、プロジェクトをプッシュします。

## Phase 2: 認証と基本レイアウト

- [x] **認証機能の実装**:
  - [x] Googleログインボタンコンポーネントを作成します。
  - [x] Firebase Authenticationを利用したログイン・ログアウト処理を実装します。
  - [x] ログイン時にFirestoreの`users`コレクションにユーザー情報を保存・更新する処理を実装します。
- [x] **レイアウト構築**:
  - [x] ヘッダー、サイドバー、フッターなどの共通レイアウトコンポーネントを作成します。
  - [x] ログイン状態やユーザーの役割（教師/生徒）に応じて表示を切り替える処理を実装します。
- [x] **アクセス制御 (Protected Routes)**:
  - [x] ログインしていないユーザーや権限のないユーザーが特定のページにアクセスした際にリダイレクトする仕組みを構築します。

## Phase 2.5: ページとコンポーネントの骨格実装 (機能なし)

- [x] **全ページと主要コンポーネントの作成**:
  - [x] `DESIGN.md` に基づき、すべての画面（生徒用ダッシュボード、授業ページ、コンテンツ表示、学習分析、教師用ダッシュボード、科目・単元・授業管理、コンテンツ管理、生徒利用状況分析、CSVアップロード、Playground）のNext.jsページファイルを作成します。
  - [x] 各ページに必要な主要なコンポーネント（例: 科目カード、授業リスト、コンテンツプレイヤーのシェル、クイズフォームのシェル、分析グラフのプレースホルダーなど）を、機能を持たせずに表示のみ実装します。
  - [x] 共通レイアウト（ヘッダー、サイドバー、フッター）との連携を確認します。

## Phase 3: 教師向け機能（コンテンツ管理）

- [ ] **CRUD機能の実装**:
  - [ ] 科目、単元、授業、コンテンツを管理（作成・読み取り・更新・削除）するためのCloud Functions (API) を作成します。
  - [ ] 上記APIと連携し、各種情報を管理するためのUI（フォーム、一覧テーブルなど）をフロントエンドに実装します。
- [ ] **CSV一括登録機能**:
  - [ ] CSVファイルをアップロードするUIを作成します。
  - [ ] アップロードされたCSVを解析し、Firestoreにデータを一括登録するCloud Functionを実装します（生徒情報、コンテンツ情報）。

## Phase 4: 生徒向け機能の実装

- [ ] **データ表示機能**:
  - [ ] Firestoreから科目、単元、授業、コンテンツの情報を取得するCloud Functions (API) を作成します。
  - [ ] 取得したデータを表示するページ（科目一覧、授業詳細ページなど）をフロントエンドに実装します。
- [ ] **コンテンツ閲覧機能**:
  - [ ] 動画コンテンツ (YouTube埋め込み) を表示するコンポーネントを作成します。
  - [ ] 外部リンクへ遷移する機能を作成します。
  - [ ] 小テストを表示し、解答できるフォームを作成します。
- [ ] **学習進捗の記録**:
  - [ ] コンテンツの閲覧や小テストの解答結果をFirestoreの`userProgress`コレクションに保存するAPIとフロントエンド処理を実装します。

## Phase 5: 教師向け機能（学習分析）

- [ ] **学習状況ダッシュボード**:
  - [ ] `userProgress`の情報を基に、自身の学習状況（視聴回数、スコアなど）を可視化するページを実装します。
- [ ] **生徒の学習状況分析**:
  - [ ] 全生徒の`userProgress`を集計・分析するAPIを作成します。
  - [ ] 分析結果をグラフやテーブルで表示するダッシュボードを実装します。

## Phase 6: Playground機能の実装

- [ ] **UIの構築**: コードエディタと実行結果を表示するエリアを持つページを作成します。
- [ ] **クライアントサイド実行環境**:
  - [ ] Pyodideを導入し、ブラウザ上でPythonコードを実行する機能を実装します。
  - [ ] JavaScriptコードを評価・実行する機能を実装します。

## Phase 7: テストとデプロイ

- [ ] **テスト**:
  - [ ] 主要なコンポーネントに対する単体テストを作成します。
  - [ ] ユーザーの主要な操作に対する結合テストを作成します。
- [ ] **デプロイ**:
  - [ ] Firebase Hostingにフロントエンドをデプロイします。
  - [ ] Cloud Functionsをデプロイします。
  - [ ] 本番環境での最終動作確認を行います。
